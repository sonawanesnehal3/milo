{"version":3,"file":"modal.merch-5ec815fb.js","sources":["../../libs/utils/action.js","../../libs/blocks/modal/modal.merch.js"],"sourcesContent":["export function debounce(callback, time = 300) {\n  if (typeof callback !== 'function') return undefined;\n\n  let timer = null;\n\n  return (...args) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => callback(...args), time);\n  };\n}\n\nexport default { debounce };\n","import { debounce } from '../../utils/action.js';\n\nexport const MOBILE_MAX = 599;\nexport const TABLET_MAX = 1199;\n\nwindow.addEventListener('pageshow', (event) => {\n  // if there is a commerce modal with an iframe open, reload the page to avoid bfcache issues.\n  if (event.persisted && document.querySelector('.dialog-modal.commerce-frame iframe')) {\n    window.location.reload();\n  }\n});\n\nexport function adjustModalHeight(contentHeight) {\n  if (!(window.location.hash || document.getElementById('checkout-link-modal'))) return;\n  let selector = '#checkout-link-modal';\n  if (!/=/.test(window.location.hash)) selector = `${selector},div.dialog-modal.commerce-frame${window.location.hash}`;\n  const dialog = document.querySelector(selector);\n  const iframe = dialog?.querySelector('iframe');\n  const iframeWrapper = dialog?.querySelector('.milo-iframe');\n  if (!contentHeight || !iframe || !iframeWrapper) return;\n  if (contentHeight === '100%') {\n    iframe.style.height = '100%';\n    iframeWrapper.style.removeProperty('height');\n    dialog.style.removeProperty('height');\n  } else {\n    const verticalMargins = 20;\n    const clientHeight = document.documentElement.clientHeight - verticalMargins;\n    if (clientHeight <= 0) return;\n    const newHeight = contentHeight > clientHeight ? clientHeight : contentHeight;\n    iframe.style.height = '100%';\n    iframeWrapper.style.height = `${newHeight}px`;\n    dialog.style.height = `${newHeight}px`;\n  }\n}\n\nexport function sendViewportDimensionsToIframe(source) {\n  const viewportWidth = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);\n  source.postMessage({ mobileMax: MOBILE_MAX, tabletMax: TABLET_MAX, viewportWidth }, '*');\n}\n\nexport function sendViewportDimensionsOnRequest(source) {\n  sendViewportDimensionsToIframe(source);\n  window.addEventListener('resize', debounce(() => sendViewportDimensionsToIframe(source), 10));\n}\n\nfunction reactToMessage({ data, source }) {\n  if (data === 'viewportWidth' && source) {\n    /* If the page inside iframe comes from another domain, it won't be able to retrieve\n    the viewport dimensions, so it sends a request to receive the viewport dimensions\n    from the parent window. */\n    sendViewportDimensionsOnRequest(source);\n  }\n\n  if (data?.contentHeight) {\n    /* If the page inside iframe sends the postMessage with its content height,\n    we activate the height auto adjustment to eliminate the blank space at the bottom of the modal.\n    For this we set the iframe height to 0% in CSS to let the page inside iframe\n    to measure its content height properly.\n    Then we set the modal height to be the same as the content height we received.\n    For the modal height adjustment to work the following conditions must be met:\n    1. The modal must have the class 'commerce-frame';\n    2. The page inside iframe must send a postMessage with the contentHeight (in px, or '100%); */\n    adjustModalHeight(data?.contentHeight);\n  }\n}\n\nexport function adjustStyles({ dialog, iframe }) {\n  const isAutoHeightAdjustment = /\\/mini-plans\\/.*mid=ft.*web=1/.test(iframe.src); // matches e.g. https://www.adobe.com/mini-plans/photoshop.html?mid=ft&web=1\n  if (isAutoHeightAdjustment) {\n    dialog.classList.add('height-fit-content');\n    // fail safe.\n    setTimeout(() => {\n      const { height } = window.getComputedStyle(iframe);\n      if (height === '0px') {\n        iframe.style.height = '100%';\n      }\n    }, 2000);\n  } else {\n    iframe.style.height = '100%';\n  }\n}\n\nexport default async function enableCommerceFrameFeatures({ dialog, iframe }) {\n  if (!dialog || !iframe) return;\n  adjustStyles({ dialog, iframe });\n  window.addEventListener('message', reactToMessage);\n}\n"],"names":["debounce","callback","time","undefined","timer","clearTimeout","setTimeout","slice","call","arguments","enableCommerceFrameFeatures","dialog","iframe","Promise","resolve","adjustStyles","window","addEventListener","reactToMessage","e","reject","MOBILE_MAX","TABLET_MAX","event","persisted","document","querySelector","location","reload","adjustModalHeight","contentHeight","hash","getElementById","selector","test","iframeWrapper","style","height","removeProperty","verticalMargins","clientHeight","documentElement","newHeight","sendViewportDimensionsToIframe","source","viewportWidth","Math","max","clientWidth","innerWidth","postMessage","mobileMax","tabletMax","sendViewportDimensionsOnRequest","data","isAutoHeightAdjustment","src","classList","add","getComputedStyle"],"mappings":"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"}