{"version":3,"file":"fragment-995a354d.js","sources":["../../libs/blocks/fragment/fragment.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nimport { createTag, getConfig, loadArea, localizeLink } from '../../utils/utils.js';\n\nconst fragMap = {};\n\nconst removeHash = (url) => {\n  const urlNoHash = url.split('#')[0];\n  return url.includes('#_dnt') ? `${urlNoHash}#_dnt` : urlNoHash;\n};\n\nconst isCircularRef = (href) => [...Object.values(fragMap)]\n  .some((tree) => {\n    const node = tree.find(href);\n    return node ? !(node.isLeaf) : false;\n  });\n\nconst updateFragMap = (fragment, a, href) => {\n  const fragLinks = [...fragment.querySelectorAll('a')]\n    .filter((link) => localizeLink(link.href).includes('/fragments/'));\n  if (!fragLinks.length) return;\n\n  if (document.body.contains(a)) { // is fragment on page (not nested)\n    // eslint-disable-next-line no-use-before-define\n    fragMap[href] = new Tree(href);\n    fragLinks.forEach((link) => fragMap[href].insert(href, localizeLink(removeHash(link.href))));\n  } else {\n    Object.values(fragMap).forEach((tree) => {\n      if (tree.find(href)) {\n        fragLinks.forEach((link) => tree.insert(href, localizeLink(removeHash(link.href))));\n      }\n    });\n  }\n};\n\nconst setManifestIdOnChildren = (sections, manifestId) => {\n  [...sections[0].children].forEach(\n    (child) => (child.dataset.manifestId = manifestId),\n  );\n};\n\nconst insertInlineFrag = (sections, a, relHref) => {\n  // Inline fragments only support one section, other sections are ignored\n  const fragChildren = [...sections[0].children];\n  fragChildren.forEach((child) => child.setAttribute('data-path', relHref));\n  if (a.parentElement.nodeName === 'DIV' && !a.parentElement.attributes.length) {\n    a.parentElement.replaceWith(...fragChildren);\n  } else {\n    a.replaceWith(...fragChildren);\n  }\n};\n\nfunction replaceDotMedia(path, doc) {\n  const resetAttributeBase = (tag, attr) => {\n    doc.querySelectorAll(`${tag}[${attr}^=\"./media_\"]`).forEach((el) => {\n      el[attr] = new URL(el.getAttribute(attr), new URL(path, window.location)).href;\n    });\n  };\n  resetAttributeBase('img', 'src');\n  resetAttributeBase('source', 'srcset');\n}\n\nexport default async function init(a) {\n  const { decorateArea, mep } = getConfig();\n  let relHref = localizeLink(a.href);\n  let inline = false;\n\n  if (a.parentElement?.nodeName === 'P') {\n    const children = a.parentElement.childNodes;\n    const div = createTag('div');\n    for (const attr of a.parentElement.attributes) div.setAttribute(attr.name, attr.value);\n    a.parentElement.replaceWith(div);\n    div.append(...children);\n  }\n\n  if (a.href.includes('#_inline')) {\n    inline = true;\n    a.href = a.href.replace('#_inline', '');\n    relHref = relHref.replace('#_inline', '');\n  }\n\n  const path = new URL(a.href).pathname;\n  if (mep?.fragments?.[path] && mep) {\n    relHref = mep.handleFragmentCommand(mep?.fragments[path], a);\n    if (!relHref) return;\n  }\n\n  if (isCircularRef(relHref)) {\n    window.lana?.log(`ERROR: Fragment Circular Reference loading ${a.href}`);\n    return;\n  }\n\n  const { customFetch } = await import('../../utils/helpers.js');\n  const resp = await customFetch({ resource: `${a.href}.plain.html`, withCacheRules: true })\n    .catch(() => ({}));\n\n  if (!resp?.ok) {\n    window.lana?.log(`Could not get fragment: ${a.href}.plain.html`);\n    return;\n  }\n\n  const html = await resp.text();\n  const doc = new DOMParser().parseFromString(html, 'text/html');\n  replaceDotMedia(a.href, doc);\n  if (decorateArea) decorateArea(doc, { fragmentLink: a });\n\n  const sections = doc.querySelectorAll('body > div');\n\n  if (!sections.length) {\n    window.lana?.log(`Could not make fragment: ${a.href}.plain.html`);\n    return;\n  }\n\n  const fragment = createTag('div', { class: 'fragment', 'data-path': relHref });\n\n  if (!inline) {\n    fragment.append(...sections);\n  }\n\n  updateFragMap(fragment, a, relHref);\n\n  if (a.dataset.manifestId) {\n    if (inline) {\n      setManifestIdOnChildren(sections, a.dataset.manifestId);\n    } else {\n      fragment.dataset.manifestId = a.dataset.manifestId;\n    }\n  }\n\n  if (inline) {\n    insertInlineFrag(sections, a, relHref);\n  } else {\n    a.parentElement.replaceChild(fragment, a);\n    await loadArea(fragment);\n  }\n}\n\nclass Node {\n  constructor(key, value = key, parent = null) {\n    this.key = key;\n    this.value = value;\n    this.parent = parent;\n    this.children = [];\n  }\n\n  get isLeaf() {\n    return this.children.length === 0;\n  }\n}\n\nexport class Tree {\n  constructor(key, value = key) {\n    this.root = new Node(key, value);\n  }\n\n  * traverse(node = this.root) {\n    yield node;\n    if (node.children.length) {\n      for (const child of node.children) {\n        yield* this.traverse(child);\n      }\n    }\n  }\n\n  insert(parentNodeKey, key, value = key) {\n    for (const node of this.traverse()) {\n      if (node.key === parentNodeKey) {\n        node.children.push(new Node(key, value, node));\n        return true;\n      }\n    }\n    return false;\n  }\n\n  remove(key) {\n    for (const node of this.traverse()) {\n      const filtered = node.children.filter((c) => c.key !== key);\n      if (filtered.length !== node.children.length) {\n        node.children = filtered;\n        return true;\n      }\n    }\n    return false;\n  }\n\n  find(key) {\n    for (const node of this.traverse()) {\n      if (node.key === key) return node;\n    }\n    return undefined;\n  }\n}\n"],"names":["init","a","_iterator","_step","decorateArea","mep","getConfig","relHref","localizeLink","href","inline","parentElement","nodeName","children","childNodes","div","createTag","_createForOfIteratorHelper","attributes","s","n","done","attr","value","setAttribute","name","err","e","f","replaceWith","append","includes","replace","path","URL","pathname","fragments","handleFragmentCommand","Promise","resolve","isCircularRef","window","lana","log","then","customFetch","resource","withCacheRules","catch","resp","ok","text","html","doc","DOMParser","parseFromString","replaceDotMedia","fragmentLink","sections","querySelectorAll","length","fragment","class","updateFragMap","dataset","manifestId","setManifestIdOnChildren","_temp","insertInlineFrag","replaceChild","loadArea","reject","fragMap","removeHash","url","urlNoHash","split","Object","values","some","tree","node","find","isLeaf","fragLinks","filter","link","document","body","contains","Tree","forEach","insert","child","fragChildren","resetAttributeBase","tag","el","getAttribute","location","Node","constructor","key","parent","root","traverse","_this","regeneratorRuntime","mark","_callee","_iterator2","_step2","wrap","_callee$","_context","prev","next","delegateYield","t1","finish","stop","parentNodeKey","_iterator3","_step3","push","remove","_iterator4","_step4","filtered","c","_iterator5","_step5","undefined"],"mappings":"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"}