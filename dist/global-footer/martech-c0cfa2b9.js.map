{"version":3,"file":"martech-c0cfa2b9.js","sources":["../../libs/martech/martech.js"],"sourcesContent":["import { getConfig, getMetadata, loadIms, loadLink, loadScript } from '../utils/utils.js';\n\nconst ALLOY_SEND_EVENT = 'alloy_sendEvent';\nconst TARGET_TIMEOUT_MS = 4000;\nconst ENTITLEMENT_TIMEOUT = 3000;\n\nconst setDeep = (obj, path, value) => {\n  const pathArr = path.split('.');\n  let currentObj = obj;\n\n  for (const key of pathArr.slice(0, -1)) {\n    if (!currentObj[key] || typeof currentObj[key] !== 'object') {\n      currentObj[key] = {};\n    }\n    currentObj = currentObj[key];\n  }\n\n  currentObj[pathArr[pathArr.length - 1]] = value;\n};\n\n// eslint-disable-next-line max-len\nconst waitForEventOrTimeout = (eventName, timeout, returnValIfTimeout) => new Promise((resolve) => {\n  const listener = (event) => {\n    // eslint-disable-next-line no-use-before-define\n    clearTimeout(timer);\n    resolve(event.detail);\n  };\n\n  const timer = setTimeout(() => {\n    window.removeEventListener(eventName, listener);\n    if (returnValIfTimeout !== undefined) {\n      resolve(returnValIfTimeout);\n    } else {\n      resolve({ timeout: true });\n    }\n  }, timeout);\n\n  window.addEventListener(eventName, listener, { once: true });\n});\n\nconst getExpFromParam = (expParam) => {\n  const lastSlash = expParam.lastIndexOf('/');\n  return {\n    experiments: [{\n      experimentPath: expParam.substring(0, lastSlash),\n      variantLabel: expParam.substring(lastSlash + 1),\n    }],\n  };\n};\n\nconst handleAlloyResponse = (response) => {\n  const items = (\n    (response.propositions?.length && response.propositions)\n    || (response.decisions?.length && response.decisions)\n    || []\n  ).map((i) => i.items).flat();\n\n  if (!items?.length) return [];\n\n  return items\n    .map((item) => {\n      const content = item?.data?.content;\n      if (!content || !(content.manifestLocation || content.manifestContent)) return null;\n\n      return {\n        manifestPath: content.manifestLocation || content.manifestPath,\n        manifestUrl: content.manifestLocation,\n        manifestData: content.manifestContent?.experiences?.data || content.manifestContent?.data,\n        manifestPlaceholders: content.manifestContent?.placeholders?.data,\n        manifestInfo: content.manifestContent?.info.data,\n        name: item.meta['activity.name'],\n        variantLabel: item.meta['experience.name'] && `target-${item.meta['experience.name']}`,\n        meta: item.meta,\n      };\n    })\n    .filter(Boolean);\n};\n\nfunction roundToQuarter(num) {\n  return Math.ceil(num / 250) / 4;\n}\n\nfunction calculateResponseTime(responseStart) {\n  const responseTime = Date.now() - responseStart;\n  return roundToQuarter(responseTime);\n}\n\nfunction sendTargetResponseAnalytics(failure, responseStart, timeout, message) {\n  // temporary solution until we can decide on a better timeout value\n  const responseTime = calculateResponseTime(responseStart);\n  const timeoutTime = roundToQuarter(timeout);\n  let val = `target response time ${responseTime}:timed out ${failure}:timeout ${timeoutTime}`;\n  if (message) val += `:${message}`;\n  window.alloy('sendEvent', {\n    documentUnloading: true,\n    xdm: {\n      eventType: 'web.webinteraction.linkClicks',\n      web: {\n        webInteraction: {\n          linkClicks: { value: 1 },\n          type: 'other',\n          name: val,\n        },\n      },\n    },\n    data: { _adobe_corpnew: { digitalData: { primaryEvent: { eventInfo: { eventName: val } } } } },\n  });\n}\n\nconst getTargetPersonalization = async () => {\n  const params = new URL(window.location.href).searchParams;\n\n  const experimentParam = params.get('experiment');\n  if (experimentParam) return getExpFromParam(experimentParam);\n\n  const timeout = parseInt(params.get('target-timeout'), 10)\n    || parseInt(getMetadata('target-timeout'), 10)\n    || TARGET_TIMEOUT_MS;\n\n  const responseStart = Date.now();\n  window.addEventListener(ALLOY_SEND_EVENT, () => {\n    const responseTime = calculateResponseTime(responseStart);\n    window.lana.log(`target response time: ${responseTime}`, { tags: 'errorType=info,module=martech' });\n  }, { once: true });\n\n  let manifests = [];\n  const response = await waitForEventOrTimeout(ALLOY_SEND_EVENT, timeout);\n  if (response.timeout) {\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, 5100 - timeout)\n      .then(() => sendTargetResponseAnalytics(true, responseStart, timeout));\n  } else {\n    sendTargetResponseAnalytics(false, responseStart, timeout);\n    manifests = handleAlloyResponse(response.result);\n  }\n\n  return manifests;\n};\n\nconst getDtmLib = (env) => ({\n  edgeConfigId: env.consumer?.edgeConfigId || env.edgeConfigId,\n  url:\n    env.name === 'prod'\n      ? env.consumer?.marTechUrl || 'https://assets.adobedtm.com/d4d114c60e50/a0e989131fd5/launch-5dd5dd2177e6.min.js'\n      : env.consumer?.marTechUrl || 'https://assets.adobedtm.com/d4d114c60e50/a0e989131fd5/launch-a27b33fc2dc0-development.min.js',\n});\n\nconst setupEntitlementCallback = () => {\n  const setEntitlements = async (destinations) => {\n    const { default: parseEntitlements } = await import('../features/personalization/entitlements.js');\n    return parseEntitlements(destinations);\n  };\n\n  const getEntitlements = (resolve) => {\n    const handleEntitlements = (detail) => {\n      if (detail?.result?.destinations?.length) {\n        resolve(setEntitlements(detail.result.destinations));\n      } else {\n        resolve([]);\n      }\n    };\n    waitForEventOrTimeout(ALLOY_SEND_EVENT, ENTITLEMENT_TIMEOUT, [])\n      .then(handleEntitlements)\n      .catch(() => resolve([]));\n  };\n\n  const { miloLibs, codeRoot, entitlements: resolveEnt } = getConfig();\n  getEntitlements(resolveEnt);\n\n  loadLink(\n    `${miloLibs || codeRoot}/features/personalization/entitlements.js`,\n    { as: 'script', rel: 'modulepreload' },\n  );\n};\n\nlet filesLoadedPromise = false;\nconst loadMartechFiles = async (config, url, edgeConfigId) => {\n  if (filesLoadedPromise) return filesLoadedPromise;\n\n  filesLoadedPromise = async () => {\n    loadIms()\n      .then(() => {\n        if (window.adobeIMS.isSignedInUser()) setupEntitlementCallback();\n      })\n      .catch(() => {});\n\n    setDeep(\n      window,\n      'alloy_all.data._adobe_corpnew.digitalData.page.pageInfo.language',\n      config.locale.ietf,\n    );\n    setDeep(window, 'digitalData.diagnostic.franklin.implementation', 'milo');\n\n    window.marketingtech = {\n      adobe: {\n        launch: { url, controlPageLoad: true },\n        alloy: { edgeConfigId },\n        target: false,\n      },\n      milo: true,\n    };\n    window.edgeConfigId = edgeConfigId;\n\n    const env = ['stage', 'local'].includes(config.env.name) ? '.qa' : '';\n    const martechPath = `martech.main.standard${env}.min.js`;\n    await loadScript(`${config.miloLibs || config.codeRoot}/deps/${martechPath}`);\n    // eslint-disable-next-line no-underscore-dangle\n    window._satellite.track('pageload');\n  };\n\n  await filesLoadedPromise();\n  return filesLoadedPromise;\n};\n\nexport default async function init({\n  persEnabled = false,\n  persManifests = [],\n  postLCP = false,\n}) {\n  const config = getConfig();\n\n  const { url, edgeConfigId } = getDtmLib(config.env);\n  loadLink(url, { as: 'script', rel: 'preload' });\n\n  const martechPromise = loadMartechFiles(config, url, edgeConfigId);\n\n  if (persEnabled) {\n    loadLink(\n      `${config.miloLibs || config.codeRoot}/features/personalization/personalization.js`,\n      { as: 'script', rel: 'modulepreload' },\n    );\n\n    const targetManifests = await getTargetPersonalization();\n    if (targetManifests?.length || persManifests?.length) {\n      const { preloadManifests, applyPers } = await import('../features/personalization/personalization.js');\n      const manifests = preloadManifests({ targetManifests, persManifests });\n      await applyPers(manifests, postLCP);\n    }\n  }\n\n  return martechPromise;\n}\n"],"names":["init","persEnabled","persManifests","postLCP","config","getConfig","url","edgeConfigId","getDtmLib","env","loadLink","as","rel","martechPromise","loadMartechFiles","_temp2","miloLibs","codeRoot","Promise","resolve","getTargetPersonalization","then","targetManifests","_temp","length","preloadManifests","applyPers","manifests","e","reject","ALLOY_SEND_EVENT","TARGET_TIMEOUT_MS","ENTITLEMENT_TIMEOUT","setDeep","obj","path","value","pathArr","split","currentObj","_iterator","_createForOfIteratorHelper","slice","_step","s","n","done","key","err","f","waitForEventOrTimeout","eventName","timeout","returnValIfTimeout","listener","event","clearTimeout","timer","detail","setTimeout","window","removeEventListener","undefined","addEventListener","once","getExpFromParam","expParam","lastSlash","lastIndexOf","experiments","experimentPath","substring","variantLabel","handleAlloyResponse","response","items","propositions","decisions","map","i","flat","item","content","data","manifestLocation","manifestContent","manifestPath","manifestUrl","manifestData","experiences","manifestPlaceholders","placeholders","manifestInfo","info","name","meta","filter","Boolean","roundToQuarter","num","Math","ceil","calculateResponseTime","responseStart","responseTime","Date","now","sendTargetResponseAnalytics","failure","message","timeoutTime","val","alloy","documentUnloading","xdm","eventType","web","webInteraction","linkClicks","type","_adobe_corpnew","digitalData","primaryEvent","eventInfo","params","URL","location","href","searchParams","experimentParam","get","parseInt","getMetadata","lana","log","tags","result","consumer","marTechUrl","setupEntitlementCallback","setEntitlements","destinations","default","parseEntitlements","getEntitlements","handleEntitlements","catch","entitlements","resolveEnt","filesLoadedPromise","loadIms","adobeIMS","isSignedInUser","locale","ietf","marketingtech","adobe","launch","controlPageLoad","target","milo","includes","martechPath","loadScript","_satellite","track"],"mappings":"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"}