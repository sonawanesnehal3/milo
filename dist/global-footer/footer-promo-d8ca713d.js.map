{"version":3,"file":"footer-promo-d8ca713d.js","sources":["../../libs/features/footer-promo.js"],"sourcesContent":["import { createTag, getConfig } from '../utils/utils.js';\nimport { decorateSectionAnalytics } from '../martech/attributes.js';\n\nasync function getPromoFromTaxonomy(contentRoot, doc) {\n  const NAME_KEY = 'Name';\n  const FOOTER_PROMO_LINK_KEY = 'Footer Promo Link';\n  const taxonomyUrl = `${contentRoot}/taxonomy.json`;\n  const tags = [...doc.head.querySelectorAll('meta[property=\"article:tag\"]')].map((el) => el.content);\n\n  if (!tags.length) return undefined;\n\n  try {\n    const resp = await fetch(taxonomyUrl);\n    if (!resp.ok) return undefined;\n    const { data } = await resp.json();\n    const primaryTag = data.find((tag) => {\n      const name = tag[NAME_KEY].split('|').pop().trim();\n      return tags.includes(name) && tag[FOOTER_PROMO_LINK_KEY];\n    });\n    if (primaryTag) return primaryTag[FOOTER_PROMO_LINK_KEY];\n  } catch (error) {\n    /* c8 ignore next 2 */\n    window.lana.log(`Footer Promo - Taxonomy error: ${error}`, { tags: 'errorType=info,module=footer-promo' });\n  }\n  return undefined;\n}\n\nexport default async function initFooterPromo(footerPromoTag, footerPromoType, doc = document) {\n  const config = getConfig();\n  const { locale: { contentRoot } } = config;\n  let href = footerPromoTag && `${contentRoot}/fragments/footer-promos/${footerPromoTag}`;\n\n  if (footerPromoType === 'taxonomy') {\n    const promo = await getPromoFromTaxonomy(contentRoot, doc);\n    if (promo) href = promo;\n  }\n\n  if (!href) return;\n\n  const { default: loadFragment } = await import('../blocks/fragment/fragment.js');\n  const a = createTag('a', { href }, href);\n  const div = createTag('div', null, a);\n  const section = createTag('div', null, div);\n  doc.querySelector('main > div:last-of-type').insertAdjacentElement('afterend', section);\n  await loadFragment(a);\n  section.classList.add('section');\n  const sections = document.querySelectorAll('main > div');\n  decorateSectionAnalytics(section, sections.length - 1, config);\n}\n"],"names":["_catch","body","recover","result","e","then","initFooterPromo","footerPromoTag","footerPromoType","doc","document","_temp3","href","Promise","resolve","default","loadFragment","a","createTag","div","section","querySelector","insertAdjacentElement","classList","add","sections","querySelectorAll","decorateSectionAnalytics","length","config","getConfig","locale","contentRoot","_temp2","getPromoFromTaxonomy","promo","reject","_exit","NAME_KEY","FOOTER_PROMO_LINK_KEY","taxonomyUrl","tags","head","map","el","content","undefined","_temp","fetch","resp","ok","json","data","primaryTag","find","tag","name","split","pop","trim","includes","_primaryTag$FOOTER_PR","error","window","lana","log","_result"],"mappings":"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"}