{"version":3,"file":"seotech-5df838a3.js","sources":["../../libs/features/seotech/seotech.js"],"sourcesContent":["export const SEOTECH_API_URL_PROD = 'https://14257-seotech.adobeioruntime.net';\nexport const SEOTECH_API_URL_STAGE = 'https://14257-seotech-stage.adobeioruntime.net';\n\nexport function logError(msg) {\n  window.lana?.log(`SEOTECH: ${msg}`, {\n    debug: false,\n    implicitSampleRate: 100,\n    sampleRate: 100,\n    tags: 'errorType=seotech',\n  });\n}\n\nexport async function getVideoObject(url, seotechAPIUrl) {\n  const videoUrl = new URL(url)?.href;\n  const videoObjectUrl = `${seotechAPIUrl}/api/v1/web/seotech/getVideoObject?url=${videoUrl}`;\n  const resp = await fetch(videoObjectUrl, { headers: { 'Content-Type': 'application/json' } });\n  const body = await resp?.json();\n  if (!resp.ok) {\n    throw new Error(`Failed to fetch video: ${body?.error}`);\n  }\n  return body.videoObject;\n}\n\nexport async function getStructuredData(url, sheetUrl, seotechAPIUrl) {\n  const apiUrl = new URL(seotechAPIUrl);\n  apiUrl.pathname = '/api/v1/web/seotech/getStructuredData';\n  apiUrl.searchParams.set('url', url);\n  if (sheetUrl) {\n    apiUrl.searchParams.set('sheetUrl', sheetUrl);\n  }\n  const resp = await fetch(apiUrl.href, { headers: { 'Content-Type': 'application/json' } });\n  const body = await resp?.json();\n  if (!resp.ok) {\n    throw new Error(`Failed to fetch structured data: ${body?.error}`);\n  }\n  return body.objects;\n}\n\nexport async function appendScriptTag({ locationUrl, getMetadata, createTag, getConfig }) {\n  const windowUrl = new URL(locationUrl);\n  const seotechAPIUrl = getConfig()?.env?.name === 'prod'\n    ? SEOTECH_API_URL_PROD : SEOTECH_API_URL_STAGE;\n\n  const append = (obj) => {\n    const script = createTag('script', { type: 'application/ld+json' }, JSON.stringify(obj));\n    document.head.append(script);\n  };\n\n  const promises = [];\n  if (getMetadata('seotech-structured-data') === 'on') {\n    const pageUrl = `${windowUrl.origin}${windowUrl.pathname}`;\n    const sheetUrl = (new URLSearchParams(windowUrl.search)).get('seotech-sheet-url') || getMetadata('seotech-sheet-url');\n    promises.push(getStructuredData(pageUrl, sheetUrl, seotechAPIUrl)\n      .then((objects) => objects.forEach((obj) => append(obj)))\n      .catch((e) => logError(e.message)));\n  }\n  if (getMetadata('seotech-video-url')) {\n    promises.push(getVideoObject(getMetadata('seotech-video-url'), seotechAPIUrl)\n      .then((videoObject) => append(videoObject))\n      .catch((e) => logError(e.message)));\n  }\n  return Promise.all(promises);\n}\n\nexport default appendScriptTag;\n"],"names":["appendScriptTag","locationUrl","getMetadata","createTag","getConfig","windowUrl","URL","seotechAPIUrl","env","name","SEOTECH_API_URL_PROD","SEOTECH_API_URL_STAGE","append","obj","script","type","JSON","stringify","document","head","promises","pageUrl","origin","pathname","sheetUrl","URLSearchParams","search","get","push","getStructuredData","then","objects","forEach","catch","e","logError","message","getVideoObject","videoObject","Promise","all","reject","url","apiUrl","searchParams","set","resolve","fetch","href","headers","resp","json","body","ok","Error","error","videoUrl","videoObjectUrl","msg","window","lana","log","debug","implicitSampleRate","sampleRate","tags"],"mappings":"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"}