{"version":3,"file":"lana-4d2fe5c0.js","sources":["../../libs/utils/lana.js"],"sourcesContent":["(function () {\n  const MSG_LIMIT = 2000;\n\n  const defaultOptions = {\n    clientId: '',\n    endpoint: 'https://www.adobe.com/lana/ll',\n    endpointStage: 'https://www.stage.adobe.com/lana/ll',\n    errorType: 'e',\n    sampleRate: 1,\n    tags: '',\n    implicitSampleRate: 1,\n    useProd: true,\n  };\n\n  const w = window;\n\n  function isProd() {\n    const { host } = window.location;\n    if (host.substring(host.length - 10) === '.adobe.com'\n      && host.substring(host.length - 15) !== '.corp.adobe.com'\n      && host.substring(host.length - 16) !== '.stage.adobe.com') {\n      return true;\n    }\n    return false;\n  }\n\n  function mergeOptions(op1, op2) {\n    if (!op1) {\n      op1 = {};\n    }\n\n    if (!op2) {\n      op2 = {};\n    }\n\n    function getOpt(key) {\n      if (op1[key] !== undefined) {\n        return op1[key];\n      }\n      if (op2[key] !== undefined) {\n        return op2[key];\n      }\n      return defaultOptions[key];\n    }\n\n    return Object.keys(defaultOptions).reduce((options, key) => {\n      options[key] = getOpt(key);\n      return options;\n    }, {});\n  }\n\n  function sendUnhandledError(e) {\n    log(e.reason || e.error || e.message, { errorType: 'i' });\n  }\n\n  function log(msg, options) {\n    msg = msg && msg.stack ? msg.stack : (msg || '');\n    if (msg.length > MSG_LIMIT) {\n      msg = `${msg.slice(0, MSG_LIMIT)}<trunc>`;\n    }\n\n    const o = mergeOptions(options, w.lana.options);\n    if (!o.clientId) {\n      console.warn('LANA ClientID is not set in options.');\n      return;\n    }\n\n    const sampleRate = o.errorType === 'i' ? o.implicitSampleRate : o.sampleRate;\n\n    if (!w.lana.debug && !w.lana.localhost && sampleRate <= Math.random() * 100) return;\n\n    const isProdDomain = isProd();\n\n    const endpoint = (!isProdDomain || !o.useProd) ? o.endpointStage : o.endpoint;\n    const queryParams = [\n      `m=${encodeURIComponent(msg)}`,\n      `c=${encodeURI(o.clientId)}`,\n      `s=${sampleRate}`,\n      `t=${encodeURI(o.errorType)}`,\n    ];\n\n    if (o.tags) {\n      queryParams.push(`tags=${encodeURI(o.tags)}`);\n    }\n\n    if (!isProdDomain || w.lana.debug || w.lana.localhost) console.log('LANA Msg: ', msg, '\\nOpts:', o);\n\n    if (!w.lana.localhost || w.lana.debug) {\n      const xhr = new XMLHttpRequest();\n      if (w.lana.debug) {\n        queryParams.push('d');\n        xhr.addEventListener('load', () => {\n          console.log('LANA response:', xhr.responseText);\n        });\n      }\n      xhr.open('GET', `${endpoint}?${queryParams.join('&')}`);\n      xhr.send();\n      return xhr;\n    }\n  }\n\n  function hasDebugParam() {\n    return w.location.search.toLowerCase().indexOf('lanadebug') !== -1;\n  }\n\n  function isLocalhost() {\n    return w.location.host.toLowerCase().indexOf('localhost') !== -1;\n  }\n\n  w.lana = {\n    debug: false,\n    log,\n    options: mergeOptions(w.lana && w.lana.options),\n  };\n\n  /* c8 ignore next */\n  if (hasDebugParam()) w.lana.debug = true;\n  if (isLocalhost()) w.lana.localhost = true;\n\n  w.addEventListener('error', sendUnhandledError);\n  w.addEventListener('unhandledrejection', sendUnhandledError);\n}());\n"],"names":["MSG_LIMIT","defaultOptions","clientId","endpoint","endpointStage","errorType","sampleRate","tags","implicitSampleRate","useProd","w","window","isProd","host","location","substring","length","mergeOptions","op1","op2","getOpt","key","undefined","Object","keys","reduce","options","sendUnhandledError","e","log","reason","error","message","msg","stack","slice","o","lana","console","warn","debug","localhost","Math","random","isProdDomain","queryParams","encodeURIComponent","encodeURI","push","xhr","XMLHttpRequest","addEventListener","responseText","open","join","send","hasDebugParam","search","toLowerCase","indexOf","isLocalhost"],"mappings":"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"}