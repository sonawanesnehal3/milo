{"version":3,"file":"preview-65955aa6.js","sources":["../../libs/features/personalization/preview.js"],"sourcesContent":["import { createTag, getConfig, getMetadata, loadStyle } from '../../utils/utils.js';\nimport { TRACKED_MANIFEST_TYPE, getFileName } from './personalization.js';\n\nfunction updatePreviewButton() {\n  const selectedInputs = document.querySelectorAll(\n    '.mep-popup input[type=\"radio\"]:checked, .mep-popup input[type=\"text\"]',\n  );\n  const manifestParameter = [];\n\n  selectedInputs.forEach((selected) => {\n    let { value } = selected;\n    if (selected.getAttribute('id') === 'new-manifest') {\n      if (selected.value !== '') {\n        try {\n          const newManifest = new URL(value);\n          if (newManifest) {\n            value = newManifest.pathname;\n          }\n        } catch (e) {\n          // do nothing\n        }\n        manifestParameter.push(value);\n      }\n    } else {\n      value = `${selected.getAttribute('name')}--${value}`;\n      manifestParameter.push(value);\n    }\n  });\n\n  const simulateHref = new URL(window.location.href);\n  simulateHref.searchParams.set('mep', manifestParameter.join('---'));\n\n  const mepHighlightCheckbox = document.querySelector(\n    '.mep-popup input[type=\"checkbox\"]#mepHighlightCheckbox',\n  );\n  document.body.dataset.mepHighlight = mepHighlightCheckbox.checked;\n  if (mepHighlightCheckbox.checked) {\n    simulateHref.searchParams.set('mepHighlight', true);\n  } else {\n    simulateHref.searchParams.delete('mepHighlight');\n  }\n\n  const mepPreviewButtonCheckbox = document.querySelector(\n    '.mep-popup input[type=\"checkbox\"]#mepPreviewButtonCheckbox',\n  );\n  if (mepPreviewButtonCheckbox.checked) {\n    simulateHref.searchParams.set('mepButton', 'off');\n  } else {\n    simulateHref.searchParams.delete('mepButton');\n  }\n\n  document\n    .querySelector('.mep-popup a.con-button')\n    .setAttribute('href', simulateHref.href);\n}\n\nfunction getRepo() {\n  const [, repo] = new URL(window.location.href).hostname.split('--');\n  if (repo) return repo;\n  try {\n    const sidekick = document.querySelector('helix-sidekick');\n    if (sidekick) {\n      const [, sidekickRepo] = new URL(JSON.parse(sidekick.getAttribute('status'))?.live.url).hostname.split('--');\n      return sidekickRepo;\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.log('Error getting repo from sidekick', e);\n  }\n  return false;\n}\n\nasync function getEditManifestUrl(a, w) {\n  const repo = getRepo();\n  if (!repo) {\n    w.location = a.dataset.manifestPath;\n    return false;\n  }\n  const response = await fetch(`https://admin.hlx.page/status/adobecom/${repo}/main${a.dataset.manifestPath}?editUrl=auto`);\n  const body = await response.json();\n  const editUrl = body?.edit?.url;\n  if (editUrl) {\n    w.location = editUrl;\n    a.href = editUrl;\n    return true;\n  }\n  w.location = a.dataset.manifestUrl;\n  return false;\n}\n\nfunction addPillEventListeners(div) {\n  div.querySelectorAll('.mep-popup input[type=\"radio\"], .mep-popup input[type=\"checkbox\"]').forEach((input) => {\n    input.addEventListener('change', updatePreviewButton);\n  });\n\n  div.querySelectorAll('.mep-popup input[type=\"text\"]').forEach((input) => {\n    input.addEventListener('keyup', updatePreviewButton);\n  });\n\n  div.querySelector('.mep-manifest.mep-badge').addEventListener('click', () => {\n    div.classList.toggle('mep-hidden');\n  });\n\n  div.querySelector('.mep-close').addEventListener('click', () => {\n    document.body.removeChild(document.querySelector('.mep-preview-overlay'));\n  });\n\n  div.querySelector('.mep-toggle-advanced').addEventListener('click', () => {\n    document.querySelector('.mep-advanced-container').classList.toggle('mep-advanced-open');\n  });\n\n  div.querySelectorAll('a[data-manifest-path]').forEach((a) => {\n    a.addEventListener('click', () => {\n      if (a.getAttribute('href')) return false;\n      const w = window.open('', '_blank');\n      w.document.write(`<html><head></head><body>\n        Please wait while we redirect you. \n        If you are not redirected, please check that you are signed into the AEM sidekick\n        and try again.\n        </body></html>`);\n      w.document.close();\n      w.focus();\n      getEditManifestUrl(a, w);\n      return true;\n    });\n  });\n}\n\nfunction createPreviewPill(manifests) {\n  const overlay = createTag('div', { class: 'mep-preview-overlay static-links', style: 'display: none;' });\n  document.body.append(overlay);\n  const div = document.createElement('div');\n  div.classList.add('mep-hidden');\n  let manifestList = '';\n  const manifestParameter = [];\n  manifests?.forEach((manifest) => {\n    const {\n      variantNames,\n      manifestPath = manifest.manifest,\n      selectedVariantName,\n      name,\n      manifestType,\n      manifestUrl,\n      manifestOverrideName,\n    } = manifest;\n    let radio = '';\n    variantNames.forEach((variant) => {\n      const checked = {\n        attribute: '',\n        class: '',\n      };\n      if (variant === selectedVariantName) {\n        checked.attribute = 'checked=\"checked\"';\n        checked.class = 'class=\"mep-manifest-selected-variant\"';\n        manifestParameter.push(`${manifestPath}--${variant}`);\n      }\n      radio += `<div>\n        <input type=\"radio\" name=\"${manifestPath}\" value=\"${variant}\" id=\"${manifestPath}--${variant}\" ${checked.attribute}>\n        <label for=\"${manifestPath}--${variant}\" ${checked.class}>${variant}</label>\n      </div>`;\n    });\n    const checked = {\n      attribute: '',\n      class: '',\n    };\n    if (!variantNames.includes(selectedVariantName)) {\n      checked.attribute = 'checked=\"checked\"';\n      checked.class = 'class=\"mep-manifest-selected-variant\"';\n      manifestParameter.push(`${manifestPath}--default`);\n    }\n    radio += `<div>\n      <input type=\"radio\" name=\"${manifestPath}\" value=\"default\" id=\"${manifestPath}--default\" ${checked.attribute}>\n      <label for=\"${manifestPath}--default\" ${checked.class}>Default (control)</label>\n    </div>`;\n\n    const manifestFileName = getFileName(manifestPath);\n    const targetTitle = name ? `${name}<br><i>${manifestFileName}</i>` : manifestFileName;\n    const scheduled = manifest.event\n      ? `<p>Scheduled - ${manifest.disabled ? 'inactive' : 'active'}</p>\n         <p>On: ${manifest.event.start?.toLocaleString()} - <a target= \"_blank\" href=\"?instant=${manifest.event.start?.toISOString()}\">instant</a></p>\n         <p>Off: ${manifest.event.end?.toLocaleString()}</p>` : '';\n    let analyticsTitle = '';\n    if (manifestType === TRACKED_MANIFEST_TYPE) {\n      analyticsTitle = 'N/A for this manifest type';\n    } else if (manifestOverrideName) {\n      analyticsTitle = manifestOverrideName;\n    } else {\n      analyticsTitle = manifestFileName.replace('.json', '').slice(0, 20);\n    }\n    manifestList += `<div class=\"mep-manifest-info\" title=\"Full url: ${manifestUrl}&#013;Analytics manifest name: ${analyticsTitle}\">\n      <div class=\"mep-manifest-title\">\n        ${targetTitle}\n        <i></i>\n        <a class=\"mep-edit-manifest\" data-manifest-url=\"${manifestUrl}\" data-manifest-path=\"${manifestPath}\" target=\"_blank\" title=\"Open manifest\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0,0,256,256\" width=\"16px\" height=\"16px\" fill-rule=\"nonzero\"><g transform=\"\"><g fill=\"#ffffff\" fill-rule=\"nonzero\" stroke=\"none\" stroke-width=\"1\" stroke-linecap=\"butt\" stroke-linejoin=\"miter\" stroke-miterlimit=\"10\" stroke-dasharray=\"\" stroke-dashoffset=\"0\" font-family=\"none\" font-weight=\"none\" font-size=\"none\" text-anchor=\"none\" style=\"mix-blend-mode: normal\"><g transform=\"scale(8.53333,8.53333)\"><path d=\"M22.82813,3c-0.51175,0 -1.02356,0.19544 -1.41406,0.58594l-2.41406,2.41406l5,5l2.41406,-2.41406c0.781,-0.781 0.781,-2.04713 0,-2.82812l-2.17187,-2.17187c-0.3905,-0.3905 -0.90231,-0.58594 -1.41406,-0.58594zM17,8l-11.74023,11.74023c0,0 0.91777,-0.08223 1.25977,0.25977c0.342,0.342 0.06047,2.58 0.48047,3c0.42,0.42 2.64389,0.12436 2.96289,0.44336c0.319,0.319 0.29688,1.29688 0.29688,1.29688l11.74023,-11.74023zM4,23l-0.94336,2.67188c-0.03709,0.10544 -0.05623,0.21635 -0.05664,0.32813c0,0.55228 0.44772,1 1,1c0.11177,-0.00041 0.22268,-0.01956 0.32813,-0.05664c0.00326,-0.00128 0.00652,-0.00259 0.00977,-0.00391l0.02539,-0.00781c0.00196,-0.0013 0.00391,-0.0026 0.00586,-0.00391l2.63086,-0.92773l-1.5,-1.5z\"></path></g></g></g></svg>\n        </a>\n        ${scheduled}\n      </div>\n      <div class=\"mep-manifest-variants\">${radio}</div>\n    </div>`;\n  });\n  const config = getConfig();\n  let targetOnText = config.mep.targetEnabled ? 'on' : 'off';\n  if (config.mep.targetEnabled === 'gnav') targetOnText = 'on for gnav only';\n  const personalizationOn = getMetadata('personalization');\n  const personalizationOnText = personalizationOn && personalizationOn !== '' ? 'on' : 'off';\n  const simulateHref = new URL(window.location.href);\n  simulateHref.searchParams.set('mep', manifestParameter.join('---'));\n\n  let mepHighlightChecked = '';\n  if (config.mep?.highlight) {\n    mepHighlightChecked = 'checked=\"checked\"';\n    document.body.dataset.mepHighlight = true;\n  }\n\n  div.innerHTML = `\n    <div class=\"mep-manifest mep-badge\">\n      <span class=\"mep-open\"></span>\n      <div class=\"mep-manifest-count\">${manifests?.length || 0} Manifest(s) served</div>\n    </div>\n    <div class=\"mep-popup\">\n    <div class=\"mep-popup-header\">\n      <div>\n        <h4>${manifests?.length || 0} Manifest(s) served</h4>\n        <span class=\"mep-close\"></span>\n        <div class=\"mep-manifest-page-info-title\">Page Info:</div>\n        <div>Target integration feature is ${targetOnText}</div>\n        <div>Personalization feature is ${personalizationOnText}</div>\n        <div>Page's Locale is ${config.locale.ietf}</div>\n      </div>\n    </div>\n    <div class=\"mep-manifest-list\">\n      <div class=\"mep-manifest-info\">\n        <div class=\"mep-manifest-variants\">\n          <input type=\"checkbox\" name=\"mepHighlight\" id=\"mepHighlightCheckbox\" ${mepHighlightChecked} value=\"true\"> <label for=\"mepHighlightCheckbox\">Highlight changes</label>\n        </div>\n      </div>\n      ${manifestList}\n      <div class=\"mep-advanced-container\">\n        <div class=\"mep-toggle-advanced\">Advanced options</div>\n        <div class=\"mep-manifest-info mep-advanced-options\">\n          <div>\n            Optional: new manifest location or path\n          </div>\n          <div class=\"mep-manifest-variants\">\n            <div>\n              <input type=\"text\" name=\"new-manifest\" id=\"new-manifest\">\n            </div>\n          </div>\n        </div>\n        <div class=\"mep-manifest-info\">\n          <div class=\"mep-manifest-variants mep-advanced-options\">\n            <input type=\"checkbox\" name=\"mepPreviewButtonCheckbox\" id=\"mepPreviewButtonCheckbox\" value=\"off\"> <label for=\"mepPreviewButtonCheckbox\">add mepButton=off to preview link</label>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"dark\">\n      <a class=\"con-button outline button-l\" href=\"${simulateHref.href}\" title=\"Preview above choices\">Preview</a>\n    </div>`;\n  overlay.append(div);\n  addPillEventListeners(div);\n}\n\nfunction addHighlightData(manifests) {\n  manifests.forEach(({ selectedVariant, manifest }) => {\n    const manifestName = getFileName(manifest);\n\n    const updateManifestId = (selector, prop = 'manifestId') => {\n      document.querySelectorAll(selector).forEach((el) => (el.dataset[prop] = manifestName));\n    };\n\n    selectedVariant?.replacefragment?.forEach(\n      ({ val }) => updateManifestId(`[data-path*=\"${val}\"]`),\n    );\n\n    selectedVariant?.useblockcode?.forEach(({ selector }) => {\n      if (selector) updateManifestId(`.${selector}`, 'codeManifestId');\n    });\n\n    selectedVariant?.updatemetadata?.forEach(({ selector }) => {\n      if (selector === 'gnav-source') updateManifestId('header, footer');\n    });\n    // eslint-disable-next-line max-len\n    document.querySelectorAll(`.section[class*=\"merch-cards\"] .fragment[data-manifest-id=\"${manifestName}\"] merch-card`)\n      .forEach((el) => (el.dataset.manifestId = manifestName));\n  });\n}\n\nexport default async function decoratePreviewMode() {\n  const { miloLibs, codeRoot, mep } = getConfig();\n  loadStyle(`${miloLibs || codeRoot}/features/personalization/preview.css`);\n  createPreviewPill(mep?.experiments);\n  if (mep?.experiments) addHighlightData(mep.experiments);\n}\n"],"names":["updatePreviewButton","selectedInputs","document","querySelectorAll","manifestParameter","forEach","selected","value","getAttribute","newManifest","URL","pathname","e","push","simulateHref","window","location","href","searchParams","set","join","mepHighlightCheckbox","querySelector","body","dataset","mepHighlight","checked","delete","mepPreviewButtonCheckbox","setAttribute","getRepo","repo","hostname","split","sidekick","sidekickRepo","JSON","parse","live","url","console","log","decoratePreviewMode","miloLibs","codeRoot","mep","getConfig","loadStyle","createPreviewPill","experiments","addHighlightData","Promise","resolve","reject","getEditManifestUrl","a","w","manifestPath","fetch","then","response","json","editUrl","edit","manifestUrl","addPillEventListeners","div","input","addEventListener","classList","toggle","removeChild","open","write","close","focus","manifests","overlay","createTag","class","style","append","createElement","add","manifestList","manifest","variantNames","selectedVariantName","name","manifestType","manifestOverrideName","radio","variant","attribute","includes","manifestFileName","getFileName","targetTitle","scheduled","event","disabled","start","toLocaleString","toISOString","end","analyticsTitle","TRACKED_MANIFEST_TYPE","replace","slice","config","targetOnText","targetEnabled","personalizationOn","getMetadata","personalizationOnText","mepHighlightChecked","highlight","innerHTML","length","locale","ietf","selectedVariant","manifestName","updateManifestId","selector","prop","el","replacefragment","val","useblockcode","updatemetadata","manifestId"],"mappings":"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"}